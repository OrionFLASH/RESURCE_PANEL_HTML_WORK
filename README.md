# Ресурсная панель (Resource Panel)

## Формулировка задачи и техническое задание

Проект представляет собой веб-приложение на чистом HTML/CSS/JavaScript для создания ресурсной панели с быстрым доступом к различным внутренним сервисам и инструментам организации. Панель обеспечивает удобную навигацию по рабочим ресурсам, группируя их по категориям, и включает в себя набор утилит для административных задач.

### Основные требования:
- Создание интуитивно понятного интерфейса с группировкой ресурсов
- Адаптивный дизайн для различных размеров экранов
- Проверка доступности ссылок в реальном времени
- Модальные окна для различных административных утилит
- Экспорт конфигурации в JSON-файл с датой и временем
- Динамическая адаптация размеров кнопок для заполнения всего блока группы

## Подробное описание решения

Проект реализован как одностраничное веб-приложение (SPA) на чистом HTML, CSS и JavaScript без использования внешних библиотек. Основные компоненты:

### Структура интерфейса:
1. **Динамический контейнер с группами ресурсов** - сетка из карточек, загружаемых из встроенного JSON-конфигурации. Каждая группа представляет категорию сервисов с карточками-ссылками
2. **Унифицированные модальные окна** - всплывающие диалоги с единой структурой и стилями для различных утилит:
   - Декодер permission (расшифровка HEX-прав)
   - Проверка роли сотрудника (ПСИ)
   - Генератор скриптов для SalesHeroes
   - Генераторы для AddressBook (по ТН и коду подразделения)
   - Выгрузка данных по новостям и наградам
   - Выгрузка профилей по табельным номерам
3. **Адаптивная сетка** - автоматическое изменение количества колонок в зависимости от размера экрана (4 колонки по умолчанию, адаптация до 1 колонки на мобильных устройствах)
4. **Встроенная конфигурация** - все данные о группах и ссылках хранятся в JSON-строке внутри HTML, что позволяет работать без сервера
5. **Адаптивная система размеров** - кнопки автоматически заполняют весь блок группы, шрифт адаптируется под размер кнопок, автоматическое переключение между 1 и 2 колонками

### Функциональные возможности:
- **Динамическая загрузка контента** - группы и карточки загружаются из встроенного JSON-конфига
- **Автоматическая проверка доступности ссылок** при загрузке страницы и каждые 2 минуты
- **Визуальная индикация недоступных ресурсов** (серый цвет для недоступных ссылок)
- **Генерация JavaScript-скриптов для DevTools** для различных административных задач
- **Экспорт конфигурации в JSON-файл** с датой и временем в имени файла
- **Копирование учетных данных в буфер обмена** по клику на определенные ссылки (с поддержкой SberBrowser)
- **Унифицированные модальные окна** с единой структурой, размерами и стилями
- **Адаптивный дизайн** для различных размеров экранов (десктоп, планшет, мобильный)
- **Умная адаптация размеров** - кнопки заполняют весь блок группы, шрифт автоматически подстраивается

## Полный список переменных и функций

### CSS Переменные (Custom Properties)

```css
--glass-bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 50%, #d4e0ed 100%)
--glass-white: rgba(255, 255, 255, 0.7)
--glass-white-light: rgba(255, 255, 255, 0.6)
--glass-white-border: rgba(255, 255, 255, 0.5)
--glass-text: #1d1d1f
--glass-text-secondary: #6e6e73
--glass-blue: #007AFF
--glass-blue-light: rgba(0, 122, 255, 0.15)
--glass-purple: #5856D6
--glass-red: #FF3B30
--glass-green: #34C759
```

**Назначение:** Централизованное управление цветовой схемой приложения в стиле Liquid Glass (iOS 26).

### JavaScript Функции

#### `adjustTopActions()`
**Назначение:** Адаптирует расположение кнопок верхнего блока в зависимости от количества групп на странице. Если групп меньше 3, кнопки располагаются вертикально, иначе горизонтально.

**Пример использования:**
```javascript
adjustTopActions(); // Вызывается автоматически при загрузке и изменении размера окна
```

#### `setStatus(card, isAvailable)`
**Параметры:**
- `card` (HTMLElement) - элемент карточки ссылки
- `isAvailable` (boolean) - флаг доступности ресурса

**Назначение:** Устанавливает визуальный статус доступности для карточки ссылки (зеленый/серый).

**Пример использования:**
```javascript
setStatus(cardElement, true);  // Помечает как доступную
setStatus(cardElement, false); // Помечает как недоступную
```

#### `checkCard(card)`
**Параметры:**
- `card` (HTMLElement) - элемент карточки с ссылкой

**Назначение:** Асинхронно проверяет доступность URL через HEAD-запрос и обновляет статус карточки.

**Пример использования:**
```javascript
checkCard(document.querySelector('.ios-card')); // Проверяет одну карточку
```

#### `checkAllCards()`
**Назначение:** Проверяет доступность всех ссылок на странице и анимирует прогресс-бар.

**Пример использования:**
```javascript
checkAllCards(); // Вызывается автоматически при загрузке и каждые 2 минуты
```

#### `generateScriptSber(type)`
**Параметры:**
- `type` (string) - тип окружения: 'alpha' или 'sigma'

**Назначение:** Генерирует JavaScript-скрипт для DevTools для выгрузки данных лидеров из SalesHeroes по указанным Tournament ID.

**Пример использования:**
```javascript
generateScriptSber('alpha');  // Генерирует скрипт для Alpha-окружения
generateScriptSber('sigma');  // Генерирует скрипт для Sigma-окружения
```

#### `generateNewsScript(env)`
**Параметры:**
- `env` (string) - окружение: 'alpha' или 'sigma'

**Назначение:** Генерирует скрипт для выгрузки деталей новостей по их кодам.

**Пример использования:**
```javascript
generateNewsScript('alpha'); // Генерирует скрипт для Alpha
```

#### `buildRewardScript({codes, baseUrl, cookie})`
**Параметры:**
- `codes` (Array<string>) - массив кодов наград
- `baseUrl` (string) - базовый URL API
- `cookie` (string) - cookie для аутентификации

**Назначение:** Строит скрипт для выгрузки данных по наградам (rewards) с пагинацией.

**Пример использования:**
```javascript
buildRewardScript({
  codes: ['r_01_2025-0_10-1_2'],
  baseUrl: 'https://efs-our-business-prom.omega.sbrf.ru/bo/rmkib.gamification/api/v1/badges/',
  cookie: document.cookie
});
```

#### `formatTabNumbers(input)`
**Параметры:**
- `input` (string) - строка с табельными номерами, разделенными любыми символами

**Возвращает:** Array<string> - массив отформатированных табельных номеров (8 цифр с ведущими нулями)

**Назначение:** Парсит и форматирует табельные номера из произвольного текстового ввода.

**Пример использования:**
```javascript
formatTabNumbers('12345, 54321; 13579'); 
// Возвращает: ['00012345', '00054321', '00013579']
```

#### `generateProfileScript(baseUrl)`
**Параметры:**
- `baseUrl` (string) - базовый URL API (Alpha или Sigma)

**Назначение:** Генерирует скрипт для выгрузки профилей сотрудников по табельным номерам.

**Пример использования:**
```javascript
generateProfileScript('https://efs-our-business-prom.omega.sbrf.ru');
```

#### `loadAndRenderConfig()`
**Назначение:** Загружает конфигурацию из встроенного JSON и рендерит все группы и карточки на странице. Сохраняет конфигурацию в глобальную переменную `globalConfig` для последующего экспорта.

**Пример использования:**
```javascript
loadAndRenderConfig(); // Вызывается автоматически при загрузке страницы
```

#### `renderGroups(groups)`
**Параметры:**
- `groups` (Array<Object>) - массив объектов групп с карточками

**Назначение:** Рендерит HTML-элементы для всех групп ресурсов на основе конфигурации.

#### `createGroupElement(group)`
**Параметры:**
- `group` (Object) - объект группы с полями: id, name, code, cards, isAdmin

**Возвращает:** HTMLElement - DOM-элемент группы

**Назначение:** Создает DOM-элемент для одной группы ресурсов с заголовком и контейнером для карточек.

#### `createCardElement(card)`
**Параметры:**
- `card` (Object) - объект карточки с полями: title, url, id, copyCode, isModal

**Возвращает:** HTMLElement - DOM-элемент карточки

**Назначение:** Создает DOM-элемент для одной карточки-ссылки с обработкой модальных окон и внешних ссылок.

#### `initDynamicEventHandlers()`
**Назначение:** Инициализирует обработчики событий для динамически созданных элементов (карточки с копированием кода, модальные окна, кнопка экспорта).

#### `adaptGroupsToFit()`
**Назначение:** Адаптирует размеры кнопок в группах для заполнения всего доступного пространства. Автоматически переключается между 1 и 2 колонками в зависимости от количества кнопок. Вычисляет оптимальную высоту кнопок и размер шрифта на основе доступного пространства. Уменьшает размеры при необходимости, чтобы избежать прокрутки.

**Логика работы:**
1. Вычисляет доступную высоту контейнера
2. Определяет количество колонок (1 или 2) на основе количества кнопок
3. Вычисляет оптимальную высоту кнопки для заполнения всего блока
4. Вычисляет оптимальный размер шрифта на основе высоты кнопки
5. При необходимости уменьшает размеры до минимума
6. Применяет вычисленные размеры ко всем кнопкам

#### `exportConfigToJSON()`
**Назначение:** Экспортирует текущую конфигурацию в JSON-файл с датой и временем в имени файла. Формат имени: `resource_panel_config_YYYYMMDD_HHMMSS.json`.

**Пример использования:**
```javascript
exportConfigToJSON(); // Вызывается при клике на кнопку "Экспорт ссылок"
```

#### `ModalManager`
**Назначение:** Универсальный менеджер для управления модальными окнами с поддержкой закрытия по клику вне окна, по Escape и фокуса.

**Методы:**
- `register(id, options)` - регистрирует модальное окно
- `open(id)` - открывает модальное окно
- `close(id)` - закрывает модальное окно

**Пример использования:**
```javascript
ModalManager.register('permission-modal');
ModalManager.open('permission-modal');
ModalManager.close('permission-modal');
```

#### `copyToClipboard(text, buttonElement)`
**Параметры:**
- `text` (string) - текст для копирования
- `buttonElement` (HTMLElement, optional) - элемент кнопки для отображения обратной связи

**Назначение:** Копирует текст в буфер обмена с поддержкой современного API и fallback для SberBrowser.

**Пример использования:**
```javascript
copyToClipboard('текст для копирования');
```

#### `Logger`
**Назначение:** Утилита для логирования с уровнями INFO и DEBUG. Может быть отключена через `CONFIG.LOGGING_ENABLED`.

**Методы:**
- `info(message, data)` - логирование информационных сообщений
- `debug(message, data)` - логирование отладочной информации
- `error(message, data)` - логирование ошибок

**Пример использования:**
```javascript
Logger.info('Страница загружена');
Logger.debug('Данные конфигурации', config);
```

#### `safeQuerySelector(selector, context)`
**Параметры:**
- `selector` (string) - CSS селектор
- `context` (HTMLElement, optional) - контекст поиска (по умолчанию document)

**Возвращает:** HTMLElement | null - найденный элемент или null

**Назначение:** Безопасный поиск элемента с предупреждением в консоль, если элемент не найден.

#### `buildCardDataMap(groups)`
**Параметры:**
- `groups` (Array<Object>) - массив групп с карточками

**Назначение:** Строит маппинг ID карточек на их данные для быстрого доступа при обработке событий.

#### `getCardDataById(id)`
**Параметры:**
- `id` (string) - ID карточки

**Возвращает:** Object | undefined - данные карточки или undefined

**Назначение:** Получает данные карточки по её ID из маппинга.

### HTML Элементы и их ID

**Модальные окна (унифицированные):**
- `permission-modal` - модальное окно декодера permission
- `role-modal` - модальное окно проверки роли
- `scriptgen-modal` - модальное окно генератора скриптов SalesHeroes
- `tn-modal` - модальное окно генератора по табельным номерам
- `dep-modal` - модальное окно генератора по коду подразделения
- `news-modal` - модальное окно выгрузки новостей
- `reward-modal` - модальное окно выгрузки наград
- `profile-modal` - модальное окно выгрузки профилей

**Другие элементы:**
- `groups-container` - контейнер для динамически загружаемых групп ресурсов
- `progress-bar` - индикатор прогресса проверки ссылок
- `export-links-btn-link` - кнопка экспорта ссылок в JSON

**CSS классы для модальных окон:**
- `modal-content` - базовый класс для всех модальных окон (стандартный размер: 700px)
- `modal-buttons-primary` - группа основных кнопок (слева)
- `modal-buttons-secondary` - группа служебных кнопок (справа)

## История версий (Version Control)

### Версия 2.1.0 (Текущая)
**Дата обновления:** 2025-01-15

**Основные изменения:**
- ✅ **Полностью переработана система адаптации размеров** - кнопки теперь заполняют весь блок группы
  - Автоматическое вычисление оптимальной высоты кнопок на основе доступного пространства
  - Адаптация размера шрифта под размер кнопок (максимум 18px, минимум 10px)
  - Автоматическое переключение между 1 и 2 колонками (порог: 6 кнопок)
  - Умное уменьшение размеров при необходимости для избежания прокрутки
- ✅ **Экспорт конфигурации в JSON** - добавлена функция экспорта текущей конфигурации в JSON-файл с датой и временем в имени
- ✅ **Улучшен дизайн в стиле Liquid Glass (iOS 26)** - светлая тема с эффектами стекла
- ✅ **Унифицированы все кнопки и модалки** - единый стиль, размеры и поведение
- ✅ **Оптимизирован размер текста** - ограничение до 2 строк, адаптивный размер шрифта

**Решенные проблемы:**
- Устранено разряженное пространство внизу групп
- Кнопки теперь равномерно заполняют весь блок группы
- Шрифт автоматически адаптируется под размер кнопок
- Улучшена читаемость и визуальная согласованность

### Версия 2.0.0
**Дата обновления:** 2025-01-XX

**Основные изменения:**
- ✅ **Рефакторинг на динамическую загрузку контента** - все группы и карточки теперь загружаются из встроенного JSON-конфигурации
- ✅ **Унификация модальных окон** - все модальные окна приведены к единому виду:
  - Единые размеры (700px)
  - Единая структура (заголовок → поля → кнопки → результат → подсказка)
  - Единый порядок кнопок (основные слева, служебные справа)
  - Единые стили без inline-атрибутов
  - Единые медиа-запросы для адаптивности
- ✅ **Улучшение структуры кода**:
  - Добавлен `ModalManager` для централизованного управления модальными окнами
  - Добавлен `Logger` для логирования с уровнями детализации
  - Добавлена утилита `safeQuerySelector` для безопасного поиска элементов
  - Реализована функция `copyToClipboard` с поддержкой SberBrowser
- ✅ **Оптимизация адаптивности** - изменена сетка на 4 колонки по умолчанию с адаптацией до 1 колонки на мобильных
- ✅ **Реорганизация контента** - переносы карточек между разделами, удаление дубликатов

**Решенные проблемы:**
- Устранены дубликаты функций и ID
- Убраны все inline стили из модальных окон
- Исправлены проблемы с CORS при работе без сервера (использование встроенного JSON)
- Оптимизирована производительность рендеринга динамического контента
- Улучшена читаемость и поддерживаемость кода

**Технические детали:**
- Проект использует чистый HTML/CSS/JavaScript без внешних зависимостей
- Конфигурация хранится в виде встроенной JSON-строки в HTML (работает без сервера)
- Все стили инкапсулированы в `<style>` блоке с использованием CSS-переменных
- JavaScript код разделен на логические модули (утилиты, менеджеры, рендеринг)
- Применены современные CSS-технологии (Grid, Flexbox, Custom Properties, Media Queries)

### Версия 1.0.0
**Дата создания:** 2025-01-XX

**Реализованный функционал:**
- ✅ Создана базовая структура HTML-страницы с адаптивным дизайном
- ✅ Реализована система группировки ресурсов по категориям
- ✅ Добавлена автоматическая проверка доступности ссылок
- ✅ Реализованы модальные окна для административных утилит
- ✅ Реализован экспорт всех ссылок в CSV-формат
- ✅ Добавлена функциональность копирования учетных данных в буфер обмена
- ✅ Настроена адаптивная сетка для различных размеров экранов
- ✅ Применена цветовая схема в стиле корпоративного дизайна

**Решенные проблемы:**
- Проблема с проверкой доступности ссылок через CORS решена использованием режима 'no-cors'
- Оптимизирована производительность проверки ссылок с добавлением задержек между запросами
- Реализована корректная обработка ошибок при генерации скриптов
- Добавлена валидация входных данных для всех генераторов скриптов

## Структура проекта

```
RESURCE_PANEL_HTML_WORK/
├── index.html                    # Основной HTML-файл приложения (все в одном файле)
├── README.md                     # Документация проекта
├── .gitignore                   # Игнорируемые файлы для Git
└── Docs/
    └── РЕКОМЕНДАЦИИ_ПО_УЛУЧШЕНИЮ.md  # Рекомендации по улучшению кода
```

**Особенности структуры:**
- Все код (HTML, CSS, JavaScript) находится в одном файле `index.html`
- Конфигурация групп и карточек встроена в HTML как JSON-строка
- Документация и рекомендации хранятся в папке `Docs`

## Использование

1. **Откройте `index.html`** в любом современном браузере (работает без сервера)
2. **Используйте карточки** для быстрого доступа к ресурсам - они автоматически загружаются из конфигурации
3. **Для административных задач** используйте группу "Администрирование" - там находятся все утилиты:
   - Декодер permission
   - Проверка роли сотрудника
   - Генераторы скриптов для различных задач
   - Выгрузка данных по новостям, наградам, профилям
4. **Сгенерированные скрипты** копируются в буфер обмена и запускаются в DevTools (F12) на соответствующих страницах
5. **Экспорт конфигурации** - используйте кнопку "Экспорт ссылок" для сохранения текущей конфигурации в JSON-файл с датой и временем

**Изменение контента:**
Для добавления новых групп или карточек отредактируйте встроенный JSON в функции `loadAndRenderConfig()` в файле `index.html`. Структура JSON:
```json
{
  "groups": [
    {
      "id": 1,
      "name": "Название группы",
      "code": "код_для_копирования",
      "cards": [
        {
          "title": "Название карточки",
          "url": "https://example.com",
          "id": "id_кнопки_для_копирования",
          "copyCode": "код_для_копирования",
          "isModal": false
        }
      ]
    }
  ]
}
```

## Технические требования

- Современный браузер с поддержкой ES6+ (Chrome, Firefox, Safari, Edge)
- JavaScript должен быть включен
- Для работы некоторых функций требуется доступ к внутренним сервисам организации

## Примечания

- Все ссылки открываются в новых вкладках (`target="_blank"`)
- Проверка доступности ссылок выполняется автоматически при загрузке и каждые 2 минуты
- Некоторые функции требуют авторизации в соответствующих системах
- Сгенерированные скрипты используют cookie текущей сессии браузера
- Кнопки автоматически адаптируются под размер блока группы для оптимального заполнения пространства
